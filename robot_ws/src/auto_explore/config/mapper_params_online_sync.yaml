slam_toolbox:
  ros__parameters:

    # DÙNG THỜI GIAN THẬT (không phải simulation)
    use_sim_time: false

    # ====== FRAME TÊN ======
    map_frame: map
    odom_frame: odom
    base_frame: base_link

    # Bạn nhớ sau này TF phải có: map -> odom -> base_link
    # (lúc đầu chỉ cần odom->base_link từ encoder/odom ảo, còn map->odom do slam_toolbox publish)

    # ====== TOPIC LIDAR ======
    scan_topic: /scan
    # hoặc sửa lại đúng với ydlidar nếu bạn dùng tên khác

    # ====== CHẾ ĐỘ ONLINE (SYNC) ======
    mode: "mapping"          # online mapping
    # "localization" dùng khi đã có bản đồ cũ

    # ====== THÔNG SỐ BẢN ĐỒ ======
    resolution: 0.05         # 5cm / ô
    min_laser_range: 0.05
    max_laser_range: 8.0
    minimum_time_interval: 0.0

    # cập nhật map sau mỗi 0.5s
    map_update_interval: 0.5

    # publish /map -> /odom TF
    publish_tf: true
    tf_buffer_duration: 30.0

    # ====== LỌC SCAN & MATCHING ======
    # khoảng robot phải di chuyển đủ lớn mới update thêm keyframe
    minimum_travel_distance: 0.10    # 10 cm
    minimum_travel_heading: 0.10     # ~6 độ
    scan_queue_size: 10

    # giới hạn vùng scan dùng cho matching
    max_laser_range_for_matching: 6.0
    max_laser_range_for_loop_closure: 6.0

    # số lần thử random khi scan matching
    scan_matcher_correspondence_randomness: 7
    scan_matcher_translation_weight: 5.0
    scan_matcher_rotation_weight: 4.0

    # ====== LOOP CLOSING (chống trôi bản đồ) ======
    do_loop_closing: true
    loop_search_maximum_distance: 4.0
    loop_search_radius: 6.0
    loop_search_minimum_chain_size: 10
    loop_search_maximum_angle: 0.2
    loop_match_minimum_chain_size: 10
    loop_match_maximum_variance_coarse: 3.0
    loop_match_maximum_variance_fine: 2.0

    # ====== LƯU / LOAD MAP (NẾU MUỐN SAU NÀY) ======
    enable_interactive_mode: false
    # nếu muốn chỉnh map bằng RViz thì cho true

    # ====== CÁC THAM SỐ KHÁC (ĐỂ MẶC ĐỊNH ỔN) ======
    transform_publish_period: 0.02   # 50 Hz
    optimization_skip_step: 3
    max_submaps: -1                  # -1 = không giới hạn
    fresh_submap_count: 3
    accumulated_submap_size: 3

    # lọc noise, lấp lỗ
    use_scan_matching: true
    use_response_expansion: true
